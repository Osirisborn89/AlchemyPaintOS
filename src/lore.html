<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Warhammer 40K Factions - Lore</title>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: #0a0a0a; color: #fff; padding: 40px; position: relative; }
h1 { color: #ffd700; margin-bottom: 30px; text-align: center; font-size: 36px; }
.nav-btn { position: absolute; top: 20px; right: 40px; background: #22c55e; color: #000; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-weight: bold; }
.nav-btn:hover { background: #16a34a; }
#grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
.tile { background: #1a1a1a; border: 2px solid #ffd700; border-radius: 8px; padding: 40px; cursor: pointer; text-align: center; transition: all 0.3s; min-height: 120px; display: flex; align-items: center; justify-content: center; }
.tile:hover { box-shadow: 0 12px 32px rgba(255,215,0,0.5); transform: scale(1.08); }
.tile h3 { color: #ffd700; font-size: 18px; margin: 0; }
#modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; justify-content: center; align-items: center; overflow: auto; padding: 20px; }
#modal.active { display: flex; }
.modal-content { background: #1a1a1a; border: 2px solid #ffd700; border-radius: 12px; padding: 40px; max-width: 750px; width: 100%; max-height: 85vh; overflow-y: auto; }
.close { color: #ffd700; font-size: 36px; cursor: pointer; float: right; margin-top: -15px; line-height: 1; }
.close:hover { color: #fff; }
#modal-body h1 { color: #ffd700; margin: 20px 0 15px 0; font-size: 28px; border-bottom: 2px solid #ffd700; padding-bottom: 10px; }
#modal-body h2 { color: #ffd700; margin: 20px 0 10px 0; font-size: 22px; }
#modal-body h3 { color: #ffed4e; margin: 15px 0 8px 0; font-size: 18px; }
#modal-body p { margin: 12px 0; line-height: 1.8; color: #ddd; }
#modal-body ul, #modal-body ol { margin: 12px 0 12px 20px; color: #ddd; }
#modal-body li { margin: 6px 0; }
#modal-body code { background: #0a0a0a; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
#modal-body pre { background: #0a0a0a; padding: 12px; border-left: 3px solid #ffd700; overflow-x: auto; margin: 12px 0; }
</style>
</head>
<body>
<a href="index.html" class="nav-btn">HOME</a>
<h1>Warhammer 40K Factions Lore</h1>
<div id="grid"></div>
<div id="modal">
<div class="modal-content">
<span class="close" onclick="closeModal()">&times;</span>
<div id="modal-body"></div>
</div>
</div>

<script>
function closeModal() {
  document.getElementById('modal').classList.remove('active');
}

document.getElementById('modal').addEventListener('click', (e) => {
  if (e.target.id === 'modal') closeModal();
});

fetch('./Data/factions_lore.csv')
  .then(r => r.text())
  .then(csv => {
    Papa.parse(csv, {
      header: true,
      skipEmptyLines: true,
      complete: (results) => {
        console.log('Loaded ' + results.data.length + ' factions');
        const grid = document.getElementById('grid');
        
        results.data.forEach(row => {
          if (row.faction && row.faction.trim()) {
            const tile = document.createElement('div');
            tile.className = 'tile';
            tile.innerHTML = '<h3>' + row.faction.trim() + '</h3>';
            tile.onclick = () => {
              const htmlContent = marked.parse(row.lore_md || 'No lore available');
              document.getElementById('modal-body').innerHTML = htmlContent;
              document.getElementById('modal').classList.add('active');
            };
            grid.appendChild(tile);
          }
        });
      },
      error: (err) => console.error('Papa Parse error:', err)
    });
  })
  .catch(e => console.error('Fetch error:', e));
</script>
</body>
</html>
